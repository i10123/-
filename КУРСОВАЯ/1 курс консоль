#include <iostream>
#include <vector>
#include <fstream>
#include <sstream>
#include <ctime>
#include <conio.h>
#include <windows.h>
#include <cmath>
#include <iomanip>
#include <map>
#include <algorithm>

using namespace std;

const string GREEN = "\033[32m";
const string RED = "\033[31m";
const string YELLOW = "\033[33m";
const string PURPLE = "\033[35m";
const string BLUE = "\033[36m";
const string RESET = "\033[0m";
const string B = "\033[1m";

// —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—á–∏—Å—Ç–∫–∏ –∫–æ–Ω—Å–æ–ª–∏
static void clearConsole() {
#ifdef _WIN32
    system("cls");
#endif
}
// —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫
static int input_check_int(const string& message, int min, int max) {
    int input;

    while (true) {
        cout << message;
        cin >> input;

        if (cin.fail() || floor(input) != input) {
            cin.clear();
            cin.ignore(INT_MAX, '\n');
            cout << "–û—à–∏–±–∫–∞ –≤–≤–æ–¥–∞! –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ —á–∏—Å–ª–æ –æ—Ç " << min << " –¥–æ " << max << endl;
            continue;
        }

        if (input < min || input > max) {
            cout << "–û—à–∏–±–∫–∞ –≤–≤–æ–¥–∞! –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ —á–∏—Å–ª–æ –æ—Ç " << min << " –¥–æ " << max << endl;
            cin.ignore(INT_MAX, '\n');
            continue;
        }

        cin.ignore(INT_MAX, '\n');
        return input;
    }
}
static double input_check_double(const string& message, double min, double max) {
    double input;

    while (true) {
        cout << message;
        cin >> input;

        if (cin.fail()) {
            cin.clear();
            cin.ignore(INT_MAX, '\n');
            cout << "–û—à–∏–±–∫–∞ –≤–≤–æ–¥–∞! –í–≤–µ–¥–∏—Ç–µ —á–∏—Å–ª–æ –æ—Ç " << fixed << setprecision(2) << min << " –¥–æ " << max << endl;
            continue;
        }

        if (input < min || input > max) {
            cout << "–û—à–∏–±–∫–∞! –ó–Ω–∞—á–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –æ—Ç " << fixed << setprecision(2) << min << " –¥–æ " << max << endl;
            cin.ignore(INT_MAX, '\n');
            continue;
        }

        cin.ignore(INT_MAX, '\n');

        return round(input * 100) / 100;
    }
}
static bool checkDateFormat(const string& date) {
    if (date.size() != 10 || date[2] != '.' || date[5] != '.') return false;

    string dayStr = date.substr(0, 2);
    string monthStr = date.substr(3, 2);
    string yearStr = date.substr(6, 4);

    for (char c : dayStr + monthStr + yearStr)
        if (!isdigit(c)) return false;

    int day = stoi(dayStr);
    int month = stoi(monthStr);
    int year = stoi(yearStr);

    if (month < 1 || month > 12 || year < 1900 || year > 2100) return false;
    int daysInMonth[] = { 31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31 };
    if (month == 2 && (year % 4 == 0 && (year % 100 != 0 || year % 400 == 0)))
        daysInMonth[1] = 29;

    return day >= 1 && day <= daysInMonth[month - 1];
}

// –≤—Å—Ç—É–ø–ª–µ–Ω–∏–µ
static void showWelcomeScreen() {
    clearConsole();

    cout << GREEN << B << "***************************************************************************\n";
    cout << "*                          –£–ß–Å–¢ –î–û–ú–ê–®–ù–ò–• –§–ò–ù–ê–ù–°–û–í                         *\n";
    cout << "***************************************************************************\n\n" << RESET;
    cout << GREEN << "–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å! –≠—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø–æ–º–æ–∂–µ—Ç –≤–∞–º –≤–µ—Å—Ç–∏ —É—á–µ—Ç –¥–æ—Ö–æ–¥–æ–≤ –∏ —Ä–∞—Å—Ö–æ–¥–æ–≤.\n";
    cout << "–í—ã –º–æ–∂–µ—Ç–µ –¥–æ–±–∞–≤–ª—è—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏, —Å–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –∏—Ö –∏ –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É.\033[0m\n\n";
    cout << BLUE << "–ù–∞–∂–º–∏—Ç–µ " << GREEN << "Enter" << BLUE << ", —á—Ç–æ–±—ã –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å –∏–ª–∏ " 
        << RED << "Esc " << BLUE << "–¥–ª—è –≤—ã—Ö–æ–¥–∞..." << RESET;

    while (true) {
        char key = _getch();
        if (key == 27) exit(0); // Esc
        if (key == 13) break;   // Enter
    }
}
// –ø–æ–ª—É—á–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–π –¥–∞—Ç—ã –∏ –≤—Ä–µ–º–µ–Ω–∏
static string getNowDateTime() {
    time_t now = time(0);
    tm localTime;
    localtime_s(&localTime, &now);

    stringstream ss;
    ss << (localTime.tm_mday < 10 ? "0" : "") << localTime.tm_mday << "."
        << ((localTime.tm_mon + 1) < 10 ? "0" : "") << (localTime.tm_mon + 1) << "."
        << (localTime.tm_year + 1900) << " "
        << (localTime.tm_hour < 10 ? "0" : "") << localTime.tm_hour << ":"
        << (localTime.tm_min < 10 ? "0" : "") << localTime.tm_min;

    return ss.str();
}
struct Transaction {
    string dateTime;        // –î–∞—Ç–∞ –∏ –í—Ä–µ–º—è
    string userName;        // –ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    string type;            // "–î–æ—Ö–æ–¥" –∏–ª–∏ "–†–∞—Å—Ö–æ–¥"
    double summa;           // –°—É–º–º–∞
    string paymentMethod;   // "–ö–∞—Ä—Ç–∞" –∏–ª–∏ "–ù–∞–ª–∏—á–Ω—ã–µ"
    string category;        // –ö–∞—Ç–µ–≥–æ—Ä–∏—è
    string storeName;       // –ù–∞–∑–≤–∞–Ω–∏–µ –º–∞–≥–∞–∑–∏–Ω–∞
    string comment;         // –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π

    Transaction()
        : dateTime(""), userName(""), type(""), summa(0), paymentMethod(""), category(""), storeName(""), comment("") {}
    
    Transaction(string user, string t, double sum, string payment, string cat, string store, string com)
        : userName(user), type(t), summa(sum), paymentMethod(payment), category(cat), storeName(store), comment(com) {
        dateTime = getNowDateTime(); // –§–æ—Ä–º–∞—Ç: –î–î.–ú–ú.–ì–ì–ì–ì –ß–ß:–ú–ú
    }

    string toTXT() const {
        stringstream ss;
        ss << dateTime << "," << userName << "," << type << "," << summa << "," << paymentMethod;
        if (type == "—Ä–∞—Å—Ö–æ–¥") { ss << "," << category << "," << storeName; }
        ss << "," << comment;
        return ss.str();
    }
};
struct Balance {
    double totalSumma;              // –û–±—â–∞—è —Å—É–º–º–∞ (–Ω–∞–ª + –∫–∞—Ä—Ç—ã)
    double cash;                    // –ù–∞–ª–∏—á–Ω—ã–µ
    double card;                    // –í—Å–µ –∫–∞—Ä—Ç—ã
    double monthExpenses;           // –°—É–º–º–∞ –≤—Å–µ—Ö —Ç—Ä–∞—Ç –∑–∞ –º–µ—Å—è—Ü
    double averageDayExpense;       // –°—Ä–µ–¥–Ω—è—è —Ç—Ä–∞—Ç–∞ –∑–∞ –¥–µ–Ω—å
    double averageMonthExpense;     // –°—Ä–µ–¥–Ω—è—è —Ç—Ä–∞—Ç–∞ –∑–∞ –º–µ—Å—è—Ü

    Balance() {
        totalSumma = 0.0;
        cash = 0.0;
        card = 0.0;
        monthExpenses = 0.0;
        averageDayExpense = 0.0;
        averageMonthExpense = 0.0;
        loadFromFile();
    }

    void saveToFile() const {
        ofstream file("balance.txt");
        if (file.is_open()) {
            file << totalSumma << "\n"
                << cash << "\n"
                << card << "\n"
                << monthExpenses << "\n"
                << averageDayExpense << "\n"
                << averageMonthExpense << "\n";
            file.close();
        }
        else {
            cerr << "–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –≤ —Ñ–∞–π–ª!\n";
        }
    }

    void loadFromFile() {
        ifstream file("balance.txt");
        if (file.is_open()) {
            file >> totalSumma;
            file >> cash;
            file >> card;
            file >> monthExpenses;
            file >> averageDayExpense;
            file >> averageMonthExpense;
            file.close();
        }
        else {
            cerr << "–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö!\n";
        }
    }
};

class MoneyManager {
private:
    Balance userBalance;
    vector<Transaction> transactions;

public:
    // 1. –ë–ê–õ–ê–ù–°
    void Balance() {
        clearConsole();
        loadTransactions();
        userBalance.loadFromFile();

        double totalBalance = userBalance.cash + userBalance.card;
        double monthExpenses = getMonthExpenses(transactions, getNowMonth(), getNowYear());
        userBalance.averageDayExpense = getAverageDayExpense(transactions);
        userBalance.averageMonthExpense = getAverageMonthExpense(transactions);
        userBalance.saveToFile();

        cout << B << PURPLE << "         **–§–ò–ù–ê–ù–°–û–í–´–ô –û–¢–ß–ï–¢**\n";
        cout << "--------------------------------------\n";
        cout << setw(26) << left << "–û–±—â–∏–π –±–∞–ª–∞–Ω—Å: " << fixed << setprecision(2) << totalBalance << " BYN\n";
        cout << "--------------------------------------\n";
        cout << setw(26) << left << "–ù–∞–ª–∏—á–Ω—ã–µ: " << userBalance.cash << " BYN\n";
        cout << "--------------------------------------\n";
        cout << setw(26) << left << "–ù–∞ –∫–∞—Ä—Ç–∞—Ö: " << userBalance.card << " BYN\n";
        cout << "--------------------------------------\n";
        cout << setw(26) << left << setw(26) << left << "–°—É–º–º–∞ —Ä–∞—Å—Ö–æ–¥–æ–≤ –∑–∞ –º–µ—Å—è—Ü: " << monthExpenses << " BYN\n";
        cout << "--------------------------------------\n";
        cout << setw(26) << left << "–°—Ä–µ–¥–Ω–∏–π —Ä–∞—Å—Ö–æ–¥ –≤ –¥–µ–Ω—å: " << userBalance.averageDayExpense << " BYN\n";
        cout << "--------------------------------------\n";
        cout << setw(26) << left << "–°—Ä–µ–¥–Ω–∏–π —Ä–∞—Å—Ö–æ–¥ –≤ –º–µ—Å—è—Ü: " << userBalance.averageMonthExpense << " BYN\n";
        cout << "--------------------------------------\n" << RESET;
    }
    // 2. –î–û–ë–ê–í–ò–¢–¨ –¢–†–ê–ù–ó–ê–ö–¶–ò–Æ
    void addTransaction() {
        clearConsole();
        string userName, type, paymentMethod = "", category = "", storeName = "", comment = "";
        double summa = 0.0;
        int paymentChoice, choice;
        do {
            cout << B << "–í–≤–µ–¥–∏—Ç–µ —Å–≤–æ—ë –∏–º—è: ";
            char choice = _getch();
            if (choice == 27) {
                cout << B << endl;
                return;
            }
            getline(cin, userName);
            if (userName.empty()) {
                cout << "–û—à–∏–±–∫–∞! –ò–º—è –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º.\n";
            }
        } while (userName.empty());

        choice = input_check_int("–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø –æ–ø–µ—Ä–∞—Ü–∏–∏ (1 - –î–æ—Ö–æ–¥, 2 - –†–∞—Å—Ö–æ–¥): ", 1, 2);

        switch (choice) {
        case 1:
            type = "–¥–æ—Ö–æ–¥";
            summa = input_check_double("–í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É: ", 0, 1000000000);
            paymentChoice = input_check_int("–í—ã–±–µ—Ä–∏—Ç–µ —Å–ø–æ—Å–æ–± –æ–ø–ª–∞—Ç—ã (1 - –ö–∞—Ä—Ç–∞, 2 - –ù–∞–ª–∏—á–Ω—ã–µ): ", 1, 2);
            paymentMethod = (paymentChoice == 1) ? "–∫–∞—Ä—Ç–∞" : "–Ω–∞–ª–∏—á–Ω—ã–µ";
            cout << "–í–≤–µ–¥–∏—Ç–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π (–ø–æ –∂–µ–ª–∞–Ω–∏—é): ";
            getline(cin, comment);

            if (paymentMethod == "–Ω–∞–ª–∏—á–Ω—ã–µ") {
                userBalance.cash += summa;
            }
            else {
                userBalance.card += summa;
            }
            break;

        case 2:
            type = "—Ä–∞—Å—Ö–æ–¥";
            summa = input_check_double("–í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É: ", 0, 1000000000);
            paymentChoice = input_check_int("–í—ã–±–µ—Ä–∏—Ç–µ —Å–ø–æ—Å–æ–± –æ–ø–ª–∞—Ç—ã (1 - –ö–∞—Ä—Ç–∞, 2 - –ù–∞–ª–∏—á–Ω—ã–µ): ", 1, 2);
            paymentMethod = (paymentChoice == 1) ? "–∫–∞—Ä—Ç–∞" : "–Ω–∞–ª–∏—á–Ω—ã–µ";
            cout << "–í–≤–µ–¥–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é —Ä–∞—Å—Ö–æ–¥–∞: ";
            getline(cin, category);
            cout << "–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –º–∞–≥–∞–∑–∏–Ω–∞: ";
            getline(cin, storeName);
            cout << "–í–≤–µ–¥–∏—Ç–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π (–ø–æ –∂–µ–ª–∞–Ω–∏—é): ";
            getline(cin, comment);

            userBalance.monthExpenses += summa;

            if (paymentMethod == "–Ω–∞–ª–∏—á–Ω—ã–µ") {
                userBalance.cash -= summa;
            }
            else {
                userBalance.card -= summa;
            }
            break;

        default:
            cout << "\n–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –≤—ã–±–æ—Ä!\n";
            return;
        }

        Transaction newTransaction(userName, type, summa, paymentMethod, category, storeName, comment);
        transactions.push_back(newTransaction);

        userBalance.totalSumma = userBalance.cash + userBalance.card;
        userBalance.saveToFile();  // üìå **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞**
        saveTransactions();        // üìå **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π**

        cout << "\n–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–∞!\n";
    }
    // 3. –†–ï–î–ê–ö–¢–ò–†–û–í–ê–¢–¨ –¢–†–ê–ù–ó–ê–ö–¶–ò–Æ
    void redactTransaction() {
        loadTransactions();
        clearConsole();

        if (transactions.empty()) {
            cout << B << "–ù–µ—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è!\n";
            return;
        }

        string Date;

        while (true) {
            cout << B << YELLOW << "–î–õ–Ø –†–ï–î–ê–ö–¢–ò–†–û–í–ê–ù–ò–Ø\n" << RESET;
            cout << B << "–í–≤–µ–¥–∏—Ç–µ –¥–∞—Ç—É —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏(–î–î.–ú–ú.–ì–ì–ì–ì) : ";
            char choice = _getch(); // —Ç—É—Ç –±–∞–≥ —Å –ø–æ–≤—Ç–æ—Ä–Ω—ã–º –≤–≤–æ–¥–æ–º –ø–µ—Ä–≤–æ–≥–æ —Å–∏–º–≤–æ–ª–∞
            if (choice == 27) {
                cout << endl;
                return;
            }
            getline(cin, Date);
            if (checkDateFormat(Date)) break;
            else clearConsole();
        }

        vector<Transaction*> listTransactions = searchTransByDate(Date);

        if (listTransactions.empty()) {
            cout << "–ù–µ—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –Ω–∞ —ç—Ç—É –¥–∞—Ç—É!\n";
            return;
        }

        cout << "–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –∑–∞ " << Date << ":\n\n";
        cout << setw(5) << left << "‚Ññ"
            << setw(8) << left << "–¢–∏–ø"
            << setw(20) << left << "–î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è"
            << setw(15) << left << "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å"
            << setw(15) << left << "–ö–∞—Ç–µ–≥–æ—Ä–∏—è"
            << setw(15) << left << "–ú–∞–≥–∞–∑–∏–Ω"
            << setw(15) << left << "–°—É–º–º–∞ (BYN)"
            << setw(15) << left << "–û–ø–ª–∞—Ç–∞"
            << setw(20) << left << "–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π" << endl;

        cout << string(120, '-') << endl;

        for (size_t i = 0; i < listTransactions.size(); i++) {
            cout << setw(5) << left << i + 1
                << setw(8) << left << listTransactions[i]->type
                << setw(20) << left << listTransactions[i]->dateTime
                << setw(15) << left << listTransactions[i]->userName
                << setw(15) << left << (listTransactions[i]->type == "—Ä–∞—Å—Ö–æ–¥" ? listTransactions[i]->category : "-")
                << setw(15) << left << (listTransactions[i]->type == "—Ä–∞—Å—Ö–æ–¥" ? listTransactions[i]->storeName : "-")
                << setw(15) << left << fixed << setprecision(2) << listTransactions[i]->summa
                << setw(15) << left << listTransactions[i]->paymentMethod
                << setw(20) << left << listTransactions[i]->comment << endl;
        }
        cout << endl;
        int index = input_check_int("–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è: ", 1, listTransactions.size()) - 1;

        while (true) {
            clearConsole();

            cout << "–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏:\n";
            cout << setw(15) << left << "–î–∞—Ç–∞:" << listTransactions[index]->dateTime << endl;
            cout << setw(15) << left << "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:" << listTransactions[index]->userName << endl;
            cout << setw(15) << left << "–¢–∏–ø:" << listTransactions[index]->type << endl;
            cout << setw(15) << left << "–°—É–º–º–∞ (BYN):" << fixed << setprecision(2) << listTransactions[index]->summa << endl;
            cout << setw(15) << left << "–ö–∞—Ç–µ–≥–æ—Ä–∏—è:" << listTransactions[index]->category << endl;
            cout << setw(15) << left << "–ú–∞–≥–∞–∑–∏–Ω:" << listTransactions[index]->storeName << endl;
            cout << setw(15) << left << "–û–ø–ª–∞—Ç–∞:" << listTransactions[index]->paymentMethod << endl;
            cout << setw(15) << left << "–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π:" << listTransactions[index]->comment << endl;
            cout << string(50, '-') << endl;

            cout << "–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ:\n";
            cout << "1. –ò–∑–º–µ–Ω–∏—Ç—å –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è\n";
            cout << "2. –ò–∑–º–µ–Ω–∏—Ç—å —Ç–∏–ø —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ (–î–æ—Ö–æ–¥/–†–∞—Å—Ö–æ–¥)\n";
            cout << "3. –ò–∑–º–µ–Ω–∏—Ç—å —Å—É–º–º—É\n";
            cout << "4. –ò–∑–º–µ–Ω–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é (—Ç–æ–ª—å–∫–æ –¥–ª—è —Ä–∞—Å—Ö–æ–¥–æ–≤)\n";
            cout << "5. –ò–∑–º–µ–Ω–∏—Ç—å –º–∞–≥–∞–∑–∏–Ω (—Ç–æ–ª—å–∫–æ –¥–ª—è —Ä–∞—Å—Ö–æ–¥–æ–≤)\n";
            cout << "6. –ò–∑–º–µ–Ω–∏—Ç—å —Å–ø–æ—Å–æ–± –æ–ø–ª–∞—Ç—ã\n";
            cout << "7. –ò–∑–º–µ–Ω–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π\n";
            cout << "8. –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è\n";
            cout << "9. –û—Ç–º–µ–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è\n";

            int choice = input_check_int("\n–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä: ", 1, 9);
            
            int newType, newType2;
            switch (choice) {
            case 1:
                cout << "–í–≤–µ–¥–∏—Ç–µ –Ω–æ–≤–æ–µ –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: ";
                getline(cin, listTransactions[index]->userName);
                break;
            case 2: {
                cout << "–í—ã–±–µ—Ä–∏—Ç–µ –Ω–æ–≤—ã–π —Ç–∏–ø —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ (1 - –î–æ—Ö–æ–¥, 2 - –†–∞—Å—Ö–æ–¥): ";
                newType = input_check_int("", 1, 2);
                listTransactions[index]->type = (newType == 1) ? "–¥–æ—Ö–æ–¥" : "—Ä–∞—Å—Ö–æ–¥";

                if (newType == 2) {
                    cout << "–í–≤–µ–¥–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é —Ä–∞—Å—Ö–æ–¥–∞: ";
                    getline(cin, listTransactions[index]->category);
                    cout << "–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –º–∞–≥–∞–∑–∏–Ω–∞: ";
                    getline(cin, listTransactions[index]->storeName);
                }
                else {
                    listTransactions[index]->category = "-";
                    listTransactions[index]->storeName = "-";
                }
                break;
            }
            case 3:
                listTransactions[index]->summa = input_check_double("–í–≤–µ–¥–∏—Ç–µ –Ω–æ–≤—É—é —Å—É–º–º—É: ", 0, 1000000000);
                break;
            case 4:
                if (listTransactions[index]->type == "—Ä–∞—Å—Ö–æ–¥") {
                    cout << "–í–≤–µ–¥–∏—Ç–µ –Ω–æ–≤—É—é –∫–∞—Ç–µ–≥–æ—Ä–∏—é: ";
                    getline(cin, listTransactions[index]->category);
                }
                break;
            case 5:
                if (listTransactions[index]->type == "—Ä–∞—Å—Ö–æ–¥") {
                    cout << "–í–≤–µ–¥–∏—Ç–µ –Ω–æ–≤—ã–π –º–∞–≥–∞–∑–∏–Ω: ";
                    getline(cin, listTransactions[index]->storeName);
                }
                break;
            case 6:
                cout << "–í–≤–µ–¥–∏—Ç–µ –Ω–æ–≤—ã–π —Å–ø–æ—Å–æ–± –æ–ø–ª–∞—Ç—ã (1 - –Ω–∞–ª–∏—á–Ω—ã–µ, 2 - –∫–∞—Ä—Ç–∞): ";
                newType2 = input_check_int("", 1, 2);
                listTransactions[index]->paymentMethod = (newType2 == 1) ? "–Ω–∞–ª–∏—á–Ω—ã–µ" : "–∫–∞—Ä—Ç–∞";

                for (auto& t : transactions) {
                    if (t.dateTime == listTransactions[index]->dateTime && t.summa == listTransactions[index]->summa) {
                        t.paymentMethod = listTransactions[index]->paymentMethod;
                        break;
                    }
                }
                break;
            case 7:
                cout << "–í–≤–µ–¥–∏—Ç–µ –Ω–æ–≤—ã–π –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π: ";
                getline(cin, listTransactions[index]->comment);
                break;
            case 8:
                saveTransactions();
                cout << "\n–ò–∑–º–µ–Ω–µ–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã!\n";
                return;
            case 9:
                cout << "\n–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–º–µ–Ω–µ–Ω–æ, –∏–∑–º–µ–Ω–µ–Ω–∏—è –Ω–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã!\n";
                loadTransactions();
                return;
            }
        }
        cout << RESET;
    }
    // 4. –£–î–ê–õ–ò–¢–¨ –¢–†–ê–ù–ó–ê–ö–¶–ò–Æ
    void deleteTransaction() {
        clearConsole();
        loadTransactions();

        if (transactions.empty()) {
            cout << B << "–ù–µ—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è!\n";
            return;
        }

        string Date;
        while (true) {
            cout << RED << "–î–õ–Ø –£–î–ê–õ–ï–ù–ò–Ø\n" << RESET;
            cout << B << "–í–≤–µ–¥–∏—Ç–µ –¥–∞—Ç—É —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ (–î–î.–ú–ú.–ì–ì–ì–ì): ";
            char choice = _getch(); // —Ç—É—Ç –±–∞–≥ —Å –ø–æ–≤—Ç–æ—Ä–Ω—ã–º –≤–≤–æ–¥–æ–º –ø–µ—Ä–≤–æ–≥–æ —Å–∏–º–≤–æ–ª–∞
            if (choice == 27) {
                cout << endl;
                return;
            }
            getline(cin, Date);
            if (checkDateFormat(Date)) break;
            else clearConsole();
        }

        Transaction lastDeletedTransaction; // –•—Ä–∞–Ω–µ–Ω–∏–µ –ø–æ—Å–ª–µ–¥–Ω–µ–π —É–¥–∞–ª–µ–Ω–Ω–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
        vector<Transaction*> listTransactions;

        while (true) {
            clearConsole();

            // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
            listTransactions = searchTransByDate(Date);

            if (listTransactions.empty()) {
                cout << "–ù–µ—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –Ω–∞ —ç—Ç—É –¥–∞—Ç—É!\n";
                return;
            }

            cout << "–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –∑–∞ " << Date << ":\n";
            cout << setw(5) << left << "‚Ññ"
                << setw(8) << left << "–¢–∏–ø"
                << setw(20) << left << "–î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è"
                << setw(15) << left << "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å"
                << setw(15) << left << "–ö–∞—Ç–µ–≥–æ—Ä–∏—è"
                << setw(15) << left << "–ú–∞–≥–∞–∑–∏–Ω"
                << setw(15) << left << "–°—É–º–º–∞ (BYN)"
                << setw(15) << left << "–û–ø–ª–∞—Ç–∞"
                << setw(20) << left << "–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π" << endl;

            cout << string(130, '-') << endl;
            for (size_t i = 0; i < listTransactions.size(); i++) {
                cout << setw(5) << left << i + 1
                    << setw(8) << left << listTransactions[i]->type
                    << setw(20) << left << listTransactions[i]->dateTime
                    << setw(15) << left << listTransactions[i]->userName
                    << setw(15) << left << (listTransactions[i]->type == "—Ä–∞—Å—Ö–æ–¥" ? listTransactions[i]->category : "-")
                    << setw(15) << left << (listTransactions[i]->type == "—Ä–∞—Å—Ö–æ–¥" ? listTransactions[i]->storeName : "-")
                    << setw(15) << left << fixed << setprecision(2) << listTransactions[i]->summa
                    << setw(15) << left << listTransactions[i]->paymentMethod
                    << setw(20) << left << listTransactions[i]->comment << endl;
            }

            cout << "\n–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ:\n";
            cout << "1. –£–¥–∞–ª–∏—Ç—å\n";
            cout << "2. –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω–µ–µ —É–¥–∞–ª–µ–Ω–∏–µ\n";
            cout << "3. –ü—Ä–µ–∫—Ä–∞—Ç–∏—Ç—å —É–¥–∞–ª–µ–Ω–∏–µ –∏ –≤–µ—Ä–Ω—É—Ç—å—Å—è –≤ –º–µ–Ω—é\n";

            int action = input_check_int("–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä –¥–µ–π—Å—Ç–≤–∏—è: ", 1, 3);
            int index;

            switch (action) {
            case 1:
                index = input_check_int("–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è –∏–ª–∏ 0 –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è –≤—Å–µ—Ö: ", 0, listTransactions.size()) - 1;

                while (true) {
                    cout << "–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å "
                        << (index == -1 ? "–í–°–ï —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏" : "—Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é [" + to_string(index + 1) + "]")
                        << "? (+/-): ";
                    char confirmation;
                    cin >> confirmation;

                    if (confirmation == '+') {
                        if (index == -1) {
                            for (auto& t : listTransactions) {
                                lastDeletedTransaction = *t; // –ó–∞–ø–æ–º–∏–Ω–∞–µ–º –ø–æ—Å–ª–µ–¥–Ω—é—é —É–¥–∞–ª–µ–Ω–Ω—É—é –∑–∞–ø–∏—Å—å
                            }

                            transactions.erase(remove_if(transactions.begin(), transactions.end(),
                                [&](const Transaction& t) { return t.dateTime.substr(0, 10) == Date; }),
                                transactions.end());

                            cout << "\n–í—Å–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –∑–∞ " << Date << " —É–¥–∞–ª–µ–Ω—ã!\n";
                        }
                        else {
                            lastDeletedTransaction = *listTransactions[index]; // –ó–∞–ø–æ–º–∏–Ω–∞–µ–º —É–¥–∞–ª–µ–Ω–Ω—É—é —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é

                            auto it = remove_if(transactions.begin(), transactions.end(),
                                [&](const Transaction& t) { return &t == listTransactions[index]; });
                            transactions.erase(it, transactions.end());
                        }
                        saveTransactions();
                        break;
                    }
                    else break;
                }
                break;

            case 2:
                cout << "–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω—é—é —É–¥–∞–ª–µ–Ω–Ω—É—é —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é? (+/-): ";
                char restore;
                cin >> restore;

                if (restore == '+') {
                    transactions.push_back(lastDeletedTransaction); // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —É–¥–∞–ª–µ–Ω–Ω—É—é —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é
                    saveTransactions();
                    loadTransactions(); // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫
                    lastDeletedTransaction = {}; // –û—á–∏—â–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ—Å–ª–µ –ø–µ—Ä–≤–æ–≥–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è
                }
                break;
            case 3: return;
            }
        }
        cout << RESET;
    }
    // 5. –ü–û–ö–ê–ó–ê–¢–¨ –í–°–ï –¢–†–ê–ù–ó–ê–ö–¶–ò–ò
    void showTransactions() {
        loadTransactions();
        clearConsole();

        if (transactions.empty()) {
            cout << "–ù–µ—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π!\n";
            return;
        }

        cout << setw(8) << left << "–¢–∏–ø"
            << setw(20) << left << "–î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è"
            << setw(15) << left << "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å"
            << setw(15) << left << "–ö–∞—Ç–µ–≥–æ—Ä–∏—è"
            << setw(15) << left << "–ú–∞–≥–∞–∑–∏–Ω"
            << setw(15) << left << "–°—É–º–º–∞ (BYN)"
            << setw(15) << left << "–û–ø–ª–∞—Ç–∞"
            << setw(20) << left << "–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π" << endl;

        cout << string(120, '-') << endl;

        for (const auto& t : transactions) {
            string color = (t.type == "–¥–æ—Ö–æ–¥") ? GREEN : RED;
            cout << color << setw(8) << left << t.type
                << setw(20) << left << t.dateTime
                << setw(15) << left << t.userName
                << setw(15) << left << (t.type == "—Ä–∞—Å—Ö–æ–¥" ? t.category : "-")
                << setw(15) << left << (t.type == "—Ä–∞—Å—Ö–æ–¥" ? t.storeName : "-")
                << setw(15) << left << fixed << setprecision(2) << t.summa
                << setw(15) << left << t.paymentMethod
                << setw(20) << left << t.comment << RESET << endl;
        }
    }
    // 6. –ë–´–°–¢–†–´–ô –ü–ï–†–ï–í–û–î –ú–ï–ñ–î–£ –°–ß–ï–¢–ê–ú–ò
    void transferBalance() {
        userBalance.loadFromFile();
        char choice;
        while (true) {
            clearConsole();
            cout << B << BLUE << "1. –ü–µ—Ä–µ–≤–µ—Å—Ç–∏ —Å –Ω–∞–ª–∏—á–Ω—ã—Ö –Ω–∞ –∫–∞—Ä—Ç—É\n";
            cout << "2. –ü–µ—Ä–µ–≤–µ—Å—Ç–∏ —Å –∫–∞—Ä—Ç—ã –Ω–∞ –Ω–∞–ª–∏—á–Ω—ã–µ\n";
            cout << "\n–í—ã–±–µ—Ä–∏—Ç–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–µ—Ä–µ–≤–æ–¥–∞: ";
            choice = _getch();
            if (choice == 27) {
                cout << RESET << endl;
                break;
            }

            if (choice != '1' && choice != '2') {
                continue;
            }
            clearConsole();
            double amount;
            amount = input_check_double("–í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É –¥–ª—è –ø–µ—Ä–µ–≤–æ–¥–∞: ", 0.0, 1000000000.0);

            if (choice == '1') { // –° –Ω–∞–ª–∏—á–Ω—ã—Ö –Ω–∞ –∫–∞—Ä—Ç—É
                if (choice == 27) break;
                else if (userBalance.cash >= amount) {
                    userBalance.cash -= amount;
                    userBalance.card += amount;
                    userBalance.saveToFile();
                    cout << GREEN << "\n–ü–µ—Ä–µ–≤–æ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω: " << amount << " BYN —Å –Ω–∞–ª–∏—á–Ω—ã—Ö –Ω–∞ –∫–∞—Ä—Ç—É.\n" << RESET;
                    break;
                }
                else {
                    cout << RED << "\n–û—à–∏–±–∫–∞: –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –Ω–∞–ª–∏—á–Ω—ã—Ö —Å—Ä–µ–¥—Å—Ç–≤!\n" << RESET;
                    return;
                }
            }
            else if (choice == '2') { // –° –∫–∞—Ä—Ç—ã –Ω–∞ –Ω–∞–ª–∏—á–Ω—ã–µ
                if (choice == 27) break;
                else if (userBalance.card >= amount) {
                    userBalance.card -= amount;
                    userBalance.cash += amount;
                    userBalance.saveToFile();
                    cout << GREEN << "\n–ü–µ—Ä–µ–≤–æ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω: " << amount << " BYN —Å –∫–∞—Ä—Ç—ã –≤ –Ω–∞–ª–∏—á–Ω—ã–µ.\n" << RESET;
                    break;
                }
                else {
                    cout << RED << "\n–û—à–∏–±–∫–∞: –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤ –Ω–∞ –∫–∞—Ä—Ç–µ!\n" << RESET;
                    return;
                }
            }
        }
    }
    // 7. –ü–û–ò–°–ö
    void search() {
        loadTransactions();
        string searchCategory;
        vector<Transaction*> results;
        while (true) {
            clearConsole();
            cout << B << "      –ü–û–ò–°–ö –¢–†–ê–ù–ó–ê–ö–¶–ò–ô\n";
            cout << "=============================\n";
            cout << "1 - –ü–æ–∏—Å–∫ –ø–æ –¥–∞—Ç–µ\n";
            cout << "2 - –ü–æ–∏—Å–∫ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏\n";
            cout << "3 - –ü–æ–∏—Å–∫ –ø–æ –º–∞–≥–∞–∑–∏–Ω—É\n";
            cout << "4 - –ü–æ–∏—Å–∫ –ø–æ —Å—É–º–º–µ\n";
            cout << "5 - –ü–æ–∏—Å–∫ –ø–æ –∫–ª—é—á–µ–≤–æ–º—É —Å–ª–æ–≤—É\n";
            cout << "=============================\n";
            cout << "–í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—Ä–∏–∞–Ω—Ç –ø–æ–∏—Å–∫–∞: ";

            char choice = _getch();
            if (choice == 27) {
                cout << endl;
                return;
            }

            if (choice != '1' && choice != '2' && choice != '3' && choice != '4' && choice != '5') {
                continue;
            }

            clearConsole();

            if (transactions.empty()) {
                cout << B << RED << "–ù–µ—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –¥–ª—è –ø–æ–∏—Å–∫–∞!\n" << RESET;
                return;
            }

            switch (choice) {
            case '1': // –ü–æ–∏—Å–∫ –ø–æ –¥–∞—Ç–µ
                while (true) {
                    cout << B << "–í–≤–µ–¥–∏—Ç–µ –¥–∞—Ç—É —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ (–î–î.–ú–ú.–ì–ì–ì–ì): ";
                    getline(cin, searchCategory);
                    if (checkDateFormat(searchCategory)) break;
                    else clearConsole();
                }
                results = searchTransByDate(searchCategory);
                break;
            case '2': // –ü–æ–∏—Å–∫ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
                cout << "–í–≤–µ–¥–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é (–µ–¥–∞, —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç, –ø–æ–¥–ø–∏—Å–∫–∏ –∏ —Ç. –¥.): ";
                getline(cin, searchCategory);
                results = searchTransByCategory(searchCategory);
                break;
            case '3': // –ü–æ–∏—Å–∫ –ø–æ –º–∞–≥–∞–∑–∏–Ω—É
                cout << "–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –º–∞–≥–∞–∑–∏–Ω–∞: ";
                getline(cin, searchCategory);
                results = searchTransByStore(searchCategory);
                break;
            case '4': { // –ü–æ–∏—Å–∫ –ø–æ —Å—É–º–º–µ (–¥–∏–∞–ø–∞–∑–æ–Ω)
                double minAmount, maxAmount;
                cout << "–í–≤–µ–¥–∏—Ç–µ –º–∏–Ω–∏–º–∞–ª—å–Ω—É—é —Å—É–º–º—É: ";
                cin >> minAmount;
                cout << "–í–≤–µ–¥–∏—Ç–µ –º–∞–∫—Å–∏–º–∞–ª—å–Ω—É—é —Å—É–º–º—É: ";
                cin >> maxAmount;
                cin.ignore();
                results = searchTransByAmount(minAmount, maxAmount);
                break;
            }
            case '5': // –ü–æ–∏—Å–∫ –ø–æ –∫–ª—é—á–µ–≤–æ–º—É —Å–ª–æ–≤—É –≤ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è—Ö
                cout << "–í–≤–µ–¥–∏—Ç–µ –∫–ª—é—á–µ–≤–æ–µ —Å–ª–æ–≤–æ: ";
                getline(cin, searchCategory);
                results = searchTransByKeyword(searchCategory);
                break;
            }
            // –í—ã–≤–æ–¥ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
            if (results.empty()) { 
                cout << RED << "\n–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã!\n" << RESET; 
                return;
            }
            else {
                cout << B << "\n=======================================================================================================================\n";
                cout << setw(4) << left << "‚Ññ"
                    << setw(18) << left << "–î–∞—Ç–∞"
                    << setw(15) << left << "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å"
                    << setw(8) << left << "–¢–∏–ø"
                    << setw(15) << left << "–°—É–º–º–∞ (BYN)"
                    << setw(15) << left << "–ö–∞—Ç–µ–≥–æ—Ä–∏—è"
                    << setw(15) << left << "–ú–∞–≥–∞–∑–∏–Ω"
                    << setw(10) << left << "–û–ø–ª–∞—Ç–∞"
                    << setw(30) << left << "–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π" << endl;
                cout << "-----------------------------------------------------------------------------------------------------------------------\n";

                size_t index = 1;
                for (const auto& t : results) {
                    cout << setw(4) << left << index++
                        << setw(18) << left << t->dateTime
                        << setw(15) << left << t->userName
                        << setw(8) << left << t->type
                        << setw(15) << left << fixed << setprecision(2) << t->summa
                        << setw(15) << left << t->category
                        << setw(15) << left << t->storeName
                        << setw(10) << left << t->paymentMethod
                        << setw(30) << left << t->comment << endl;
                }
                cout << "=======================================================================================================================\n" << RESET;
                return;
            }
        }
    }
    // 8. –§–ò–õ–¨–¢–†–´
    void filter() {
        loadTransactions();

        // –ö–æ–ø–∏—Ä—É–µ–º —É–∫–∞–∑–∞—Ç–µ–ª–∏ –Ω–∞ –æ–±—ä–µ–∫—Ç—ã —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
        vector<Transaction*> filteredTransactions;
        filteredTransactions.reserve(transactions.size()); // –£–ª—É—á—à–∞–µ—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è
        for (auto& t : transactions) {
            filteredTransactions.push_back(&t);
        }

        string typeFilter, paymentFilter;
        char sortChoice, dateSortChoice, typeChoice, paymentChoice;

        while (true) {
            clearConsole();
            cout << B << "     –§–ò–õ–¨–¢–†–´ –¢–†–ê–ù–ó–ê–ö–¶–ò–ô\n";
            cout << "=============================\n";
            cout << "1. –§–∏–ª—å—Ç—Ä –ø–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é\n";
            cout << "2. –§–∏–ª—å—Ç—Ä –ø–æ —Ü–µ–Ω–µ\n";
            cout << "3. –§–∏–ª—å—Ç—Ä –ø–æ –¥–∞—Ç–µ\n";
            cout << "4. –§–∏–ª—å—Ç—Ä –ø–æ —Ç–∏–ø—É —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏\n";
            cout << "5. –§–∏–ª—å—Ç—Ä –ø–æ —Å–ø–æ—Å–æ–±—É –æ–ø–ª–∞—Ç—ã\n";
            cout << "=============================\n";
            cout << "–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∏–ª—å—Ç—Ä: ";

            char choice = _getch();
            if (choice == 27) return;

            if (choice != '1' && choice != '2' && choice != '3' && choice != '4' && choice != '5') {
                continue;
            }

            clearConsole();

            if (transactions.empty()) {
                cout << B << RED << "–ù–µ—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏!\n" << RESET;
                return;
            }

            string filterQuery;

            sort(filteredTransactions.begin(), filteredTransactions.end(), [](Transaction* a, Transaction* b) {
                int yearA = stoi(a->dateTime.substr(6, 4));
                int monthA = stoi(a->dateTime.substr(3, 2));
                int dayA = stoi(a->dateTime.substr(0, 2));
                int hourA = stoi(a->dateTime.substr(11, 2));
                int minuteA = stoi(a->dateTime.substr(14, 2));

                int yearB = stoi(b->dateTime.substr(6, 4));
                int monthB = stoi(b->dateTime.substr(3, 2));
                int dayB = stoi(b->dateTime.substr(0, 2));
                int hourB = stoi(b->dateTime.substr(11, 2));
                int minuteB = stoi(b->dateTime.substr(14, 2));

                if (yearA != yearB) return yearA > yearB;
                if (monthA != monthB) return monthA > monthB;
                if (dayA != dayB) return dayA > dayB;
                if (hourA != hourB) return hourA > hourB;
                return minuteA > minuteB;
                });
            switch (choice) {
            case '1': // üìå –§–∏–ª—å—Ç—Ä –ø–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
                cout << "–í–≤–µ–¥–∏—Ç–µ –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: ";
                getline(cin, filterQuery);
                filteredTransactions.erase(remove_if(filteredTransactions.begin(), filteredTransactions.end(),
                    [&filterQuery](Transaction* t) { return t->userName != filterQuery; }), filteredTransactions.end());
                break;

            case '2': // üìå –§–∏–ª—å—Ç—Ä –ø–æ —Ü–µ–Ω–µ
                while (true) {
                    cout << "–í—ã–±–µ—Ä–∏—Ç–µ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫—É (1 - –ü–æ –≤–æ–∑—Ä–∞—Å—Ç–∞–Ω–∏—é, 2 - –ü–æ —É–±—ã–≤–∞–Ω–∏—é): ";
                    sortChoice = _getch();
                    if (sortChoice != '1' && sortChoice != '2') {
                        clearConsole();
                        continue;
                    }
                    sort(filteredTransactions.begin(), filteredTransactions.end(),
                        [sortChoice](Transaction* a, Transaction* b) { return (sortChoice == '1') ? a->summa < b->summa : a->summa > b->summa; });
                    break;
                }
                break;

            case '3': // –§–∏–ª—å—Ç—Ä –ø–æ –¥–∞—Ç–µ 
                char dateSortChoice; 
                while (true) { 
                    cout << "–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ—Ä—è–¥–æ–∫ (1 - –ù–æ–≤—ã–µ, 2 - –°—Ç–∞—Ä—ã–µ): "; 
                    dateSortChoice = _getch(); 
                    if (dateSortChoice != '1' && dateSortChoice != '2') { 
                        clearConsole(); 
                        continue; 
                    }
                    // –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ —Å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Ä–∞–∑–±–∏–≤–∫–æ–π –¥–∞—Ç—ã 
                    sort(filteredTransactions.begin(), filteredTransactions.end(), 
                        [dateSortChoice](Transaction* a, Transaction* b) { 
                            int yearA = stoi(a->dateTime.substr(6, 4)); 
                            int monthA = stoi(a->dateTime.substr(3, 2));
                            int dayA = stoi(a->dateTime.substr(0, 2)); 
                            int hourA = stoi(a->dateTime.substr(11, 2));
                            int minuteA = stoi(a->dateTime.substr(14, 2));
                            int yearB = stoi(b->dateTime.substr(6, 4)); 
                            int monthB = stoi(b->dateTime.substr(3, 2)); 
                            int dayB = stoi(b->dateTime.substr(0, 2)); 
                            int hourB = stoi(b->dateTime.substr(11, 2));
                            int minuteB = stoi(b->dateTime.substr(14, 2));
                    if (yearA != yearB) return (dateSortChoice == '1') ? yearA > yearB : yearA < yearB; 
                    if (monthA != monthB) return (dateSortChoice == '1') ? monthA > monthB : monthA < monthB; 
                    if (dayA != dayB) return (dateSortChoice == '1') ? dayA > dayB : dayA < dayB; 
                    if (hourA != hourB) return (dateSortChoice == '1') ? hourA > hourB : hourA < hourB; return (dateSortChoice == '1') ? minuteA > minuteB : minuteA < minuteB;
                }); break;
            } break;

            case '4': // –§–∏–ª—å—Ç—Ä –ø–æ —Ç–∏–ø—É
                while (true) {
                    cout << "–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø (1 - –î–æ—Ö–æ–¥, 2 - –†–∞—Å—Ö–æ–¥): ";
                    typeChoice = _getch();
                    if (typeChoice != '1' && typeChoice != '2') {
                        clearConsole();
                        continue;
                    }
                    string typeFilter = (typeChoice == '1') ? "–¥–æ—Ö–æ–¥" : "—Ä–∞—Å—Ö–æ–¥";
                    filteredTransactions.erase(remove_if(filteredTransactions.begin(), filteredTransactions.end(),
                        [&typeFilter](Transaction* t) { return t->type != typeFilter; }), filteredTransactions.end());
                    break;
                }
                break;

            case '5': // –§–∏–ª—å—Ç—Ä –ø–æ —Å–ø–æ—Å–æ–±—É –æ–ø–ª–∞—Ç—ã
                while (true) {
                    cout << "–í—ã–±–µ—Ä–∏—Ç–µ —Å–ø–æ—Å–æ–± –æ–ø–ª–∞—Ç—ã (1 - –ù–∞–ª–∏—á–Ω—ã–µ, 2 - –ö–∞—Ä—Ç–∞): ";
                    paymentChoice = _getch();
                    if (paymentChoice != '1' && paymentChoice != '2') {
                        clearConsole();
                        continue;
                    }
                    string paymentFilter = (paymentChoice == '1') ? "–Ω–∞–ª–∏—á–Ω—ã–µ" : "–∫–∞—Ä—Ç–∞";
                    filteredTransactions.erase(remove_if(filteredTransactions.begin(), filteredTransactions.end(),
                        [&paymentFilter](Transaction* t) { return t->paymentMethod != paymentFilter; }), filteredTransactions.end());
                    break;
                }
                break;
            }

            // –í—ã–≤–æ–¥ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
            if (filteredTransactions.empty()) {
                cout << RED << "\n–ù–µ—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –ø–æ –∑–∞–¥–∞–Ω–Ω–æ–º—É —Ñ–∏–ª—å—Ç—Ä—É!\n" << RESET;
                return;
            }
            cout << B << "\n=======================================================================================================================\n";
            cout << setw(4) << left << "‚Ññ"
                << setw(18) << left << "–î–∞—Ç–∞"
                << setw(15) << left << "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å"
                << setw(8) << left << "–¢–∏–ø"
                << setw(15) << left << "–°—É–º–º–∞ (BYN)"
                << setw(15) << left << "–ö–∞—Ç–µ–≥–æ—Ä–∏—è"
                << setw(15) << left << "–ú–∞–≥–∞–∑–∏–Ω"
                << setw(10) << left << "–û–ø–ª–∞—Ç–∞"
                << setw(30) << left << "–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π" << endl;
            cout << "-----------------------------------------------------------------------------------------------------------------------\n";

            size_t index = 1;
            for (const auto& t : filteredTransactions) {
                cout << setw(4) << left << index++
                    << setw(18) << left << t->dateTime
                    << setw(15) << left << t->userName
                    << setw(8) << left << t->type
                    << setw(15) << left << fixed << setprecision(2) << t->summa
                    << setw(15) << left << t->category
                    << setw(15) << left << t->storeName
                    << setw(10) << left << t->paymentMethod
                    << setw(30) << left << t->comment << endl;
            }
            cout << "=======================================================================================================================\n" << RESET;
            return;
        }
    }
    // 9. –°–¢–ê–¢–ò–°–¢–ò–ö–ê
    void Statistics() {
        loadTransactions();
        clearConsole();
        userBalance.loadFromFile();

        double totalExpenses = 0, totalIncome = 0;
        double maxExpense = 0;
        string maxExpenseItem = "";
        map<string, double> categoryExpenses;
        map<string, int> storeCount;
        map<string, bool> incomeMonths; // –î–ª—è –ø–æ–¥—Å—á–µ—Ç–∞ –º–µ—Å—è—Ü–µ–≤ —Å –¥–æ—Ö–æ–¥–∞–º–∏

        // –ê–Ω–∞–ª–∏–∑ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
        for (const auto& t : transactions) {
            string monthYear = t.dateTime.substr(3, 7); // "MM.YYYY"

            if (t.type == "–¥–æ—Ö–æ–¥") {
                totalIncome += t.summa;
                incomeMonths[monthYear] = true; // –ó–∞–ø–æ–º–∏–Ω–∞–µ–º, —á—Ç–æ –≤ —ç—Ç–æ–º –º–µ—Å—è—Ü–µ –±—ã–ª –¥–æ—Ö–æ–¥
            }
            else if (t.type == "—Ä–∞—Å—Ö–æ–¥") {
                totalExpenses += t.summa;
                categoryExpenses[t.category] += t.summa;
                storeCount[t.storeName]++;

                // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Å–∞–º—É—é –∫—Ä—É–ø–Ω—É—é –ø–æ–∫—É–ø–∫—É
                if (t.summa > maxExpense) {
                    maxExpense = t.summa;
                    maxExpenseItem = t.category + " (" + t.storeName + ")";
                }
            }
        }

        // –°—Ä–µ–¥–Ω–∏–π –¥–æ—Ö–æ–¥ –∑–∞ –º–µ—Å—è—Ü
        int activeIncomeMonths = incomeMonths.size(); // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–µ—Å—è—Ü–µ–≤ —Å –¥–æ—Ö–æ–¥–∞–º–∏
        double avgMonthlyIncome = (activeIncomeMonths > 0) ? totalIncome / activeIncomeMonths : 0.0;

        // –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –Ω–∞–∏–±–æ–ª—å—à–µ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —Ä–∞—Å—Ö–æ–¥–æ–≤
        string topCategory = "";
        double maxCategoryExpense = 0;
        for (const auto& category : categoryExpenses) {
            if (category.second > maxCategoryExpense) {
                maxCategoryExpense = category.second;
                topCategory = category.first;
            }
        }

        // –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å–∞–º–æ–≥–æ –ø–æ–ø—É–ª—è—Ä–Ω–æ–≥–æ –º–∞–≥–∞–∑–∏–Ω–∞
        string topStore = "";
        int maxStoreVisits = 0;
        for (const auto& store : storeCount) {
            if (store.second > maxStoreVisits) {
                maxStoreVisits = store.second;
                topStore = store.first;
            }
        }

        // –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å –ø—Ä–µ–¥—ã–¥—É—â–∏–º–∏ –º–µ—Å—è—Ü–∞–º–∏
        double prevMonthExpenses = getMonthExpenses(transactions, getNowMonth() - 1, getNowYear());
        double prevMonthIncome = getIncomeForMonth(transactions, getNowMonth() - 1, getNowYear());

        double expenseDifference = totalExpenses - prevMonthExpenses;
        double incomeDifference = totalIncome - prevMonthIncome;

        // –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –æ —Ä–∏—Å–∫–∞—Ö
        bool budgetRisk = totalExpenses > totalIncome * 0.8;
        bool negativeBudget = totalExpenses > totalIncome;

        // –í—ã–≤–æ–¥ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
        cout << B << BLUE << "               **–°–¢–ê–¢–ò–°–¢–ò–ö–ê –§–ò–ù–ê–ù–°–û–í** \n";
        cout << "=======================================================\n";
        cout << setw(28) << left << "–û–±—â–∞—è —Å—É–º–º–∞ –¥–æ—Ö–æ–¥–æ–≤: " << fixed << setprecision(2) << totalIncome << " BYN\n";
        cout << "-------------------------------------------------------\n";
        cout << setw(28) << left << "–°—Ä–µ–¥–Ω–∏–π –¥–æ—Ö–æ–¥ –∑–∞ –º–µ—Å—è—Ü: " << fixed << setprecision(2) << avgMonthlyIncome << " BYN\n";
        cout << "-------------------------------------------------------\n";
        cout << setw(28) << left << "–û–±—â–∞—è —Å—É–º–º–∞ —Ä–∞—Å—Ö–æ–¥–æ–≤: " << fixed << setprecision(2) << totalExpenses << " BYN\n";
        cout << "-------------------------------------------------------\n";
        cout << setw(28) << left << "–°—Ä–µ–¥–Ω–∏–π —Ä–∞—Å—Ö–æ–¥ –∑–∞ –º–µ—Å—è—Ü: " << fixed << setprecision(2) << userBalance.averageMonthExpense << " BYN\n";
        cout << "-------------------------------------------------------\n";
        cout << setw(28) << left << "–°—Ä–µ–¥–Ω–∏–π —Ä–∞—Å—Ö–æ–¥ –∑–∞ –¥–µ–Ω—å: " << fixed << setprecision(2) << userBalance.averageDayExpense << " BYN\n";
        cout << "-------------------------------------------------------\n";
        cout << setw(28) << left << "–°–∞–º–∞—è –∫—Ä—É–ø–Ω–∞—è –ø–æ–∫—É–ø–∫–∞: " << maxExpenseItem << " (" << fixed << setprecision(2) << maxExpense << " BYN)\n";
        cout << "-------------------------------------------------------\n";
        cout << setw(28) << left << "–°–∞–º–∞—è –∑–∞—Ç—Ä–∞—Ç–Ω–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è: " << topCategory << " (" << maxCategoryExpense << " BYN)\n";
        cout << "-------------------------------------------------------\n";
        cout << setw(28) << left << "–°–∞–º—ã–π –ø–æ–ø—É–ª—è—Ä–Ω—ã–π –º–∞–≥–∞–∑–∏–Ω: " << topStore << " (—Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π: " << maxStoreVisits << ")\n";
        cout << "-------------------------------------------------------\n";

        cout << "–°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å –ø—Ä–µ–¥—ã–¥—É—â–∏–º –º–µ—Å—è—Ü–µ–º:\n";

        if (expenseDifference > 0) {
            cout << setw(9) << left << "–†–∞—Å—Ö–æ–¥—ã: " << "[+] —É–≤–µ–ª–∏—á–∏–ª–∏—Å—å –Ω–∞ " << fixed << setprecision(2) << expenseDifference << " BYN\n";
        }
        else {
            cout << setw(9) << left << "–†–∞—Å—Ö–æ–¥—ã: " << "[-] —Å–Ω–∏–∑–∏–ª–∏—Å—å –Ω–∞ " << fixed << setprecision(2) << abs(expenseDifference) << " BYN\n";
        }

        if (incomeDifference > 0) {
            cout << setw(9) << left << "–î–æ—Ö–æ–¥—ã: " << "[+] —É–≤–µ–ª–∏—á–∏–ª–∏—Å—å –Ω–∞ " << fixed << setprecision(2) << incomeDifference << " BYN\n";
        }
        else {
            cout << setw(9) << left << "–î–æ—Ö–æ–¥—ã: " << "[-] —Å–Ω–∏–∑–∏–ª–∏—Å—å –Ω–∞ " << fixed << setprecision(2) << abs(incomeDifference) << " BYN\n";
        }

        cout << "=======================================================\n" << RESET;

        if (budgetRisk) {
            cout << B << RED << "\n! ! ! –í–Ω–∏–º–∞–Ω–∏–µ: —Ä–∞—Å—Ö–æ–¥—ã –ø—Ä–µ–≤—ã—à–∞—é—Ç 80% –æ—Ç –¥–æ—Ö–æ–¥–æ–≤!\n" << RESET;
        }
        if (negativeBudget) {
            cout << B << RED << "\n! ! ! –°—Ä–æ—á–Ω–æ–µ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ: –±—é–¥–∂–µ—Ç –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–π!\n" << RESET;
        }
    }
    // 0. –ù–ê–°–¢–†–û–ô–ö–ò
    void setupSettings() {
        clearConsole();
        cout << "–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ: –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –±–∞–ª–∞–Ω—Å–∞ –º–µ–Ω—è–µ—Ç—Å—è –¢–û–õ–¨–ö–û –±–∞–ª–∞–Ω—Å\n\n";
        cout << "      **–ù–ê–°–¢–†–û–ô–ö–ò –§–ò–ù–ê–ù–°–û–í**\n";
        cout << "--------------------------------------\n";

        cout << "–í–≤–µ–¥–∏—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–∞—Ä—Ç: ";
        int cardCount;
        cin >> cardCount;

        double newCardAmount = 0; // –í—Ä–µ–º–µ–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ (–Ω–µ –∏–∑–º–µ–Ω—è–µ–º —Å—Ä–∞–∑—É)
        for (int i = 0; i < cardCount; i++) {
            double cardBalance;
            cout << "–í–≤–µ–¥–∏—Ç–µ –æ—Å—Ç–∞—Ç–æ–∫ –Ω–∞ –∫–∞—Ä—Ç–µ " << i + 1 << ": ";
            cin >> cardBalance;
            newCardAmount += cardBalance;
        }

        cout << "–í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É –Ω–∞–ª–∏—á–Ω—ã—Ö: ";
        double newCashAmount;
        cin >> newCashAmount;
        double newTotalSumma = newCashAmount + newCardAmount;

        cout << "\n–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è? (+/-): ";
        char confirm;
        cin >> confirm;

        if (confirm == '+') {
            userBalance.card = newCardAmount;
            userBalance.cash = newCashAmount;
            userBalance.totalSumma = newTotalSumma;
            userBalance.saveToFile();
            cout << "\n–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã!\n";
        }
        else {
            cout << "\n–ò–∑–º–µ–Ω–µ–Ω–∏—è –æ—Ç–º–µ–Ω–µ–Ω—ã!\n";
        }
    }

    
    // –∑–∞–≥—Ä—É–∑–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
    void loadTransactions() {
        transactions.clear();
        ifstream file("transactions.txt");
        if (!file) {
            cout << "–ù–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π!\n";
            return;
        }

        string line;
        while (getline(file, line)) {
            stringstream ss(line);
            string dateTime, userName, type, summaStr, paymentMethod, category, storeName, comment;

            getline(ss, dateTime, ',');
            getline(ss, userName, ',');
            getline(ss, type, ',');
            getline(ss, summaStr, ',');
            getline(ss, paymentMethod, ',');
            if (type == "—Ä–∞—Å—Ö–æ–¥") {
                getline(ss, category, ',');
                getline(ss, storeName, ',');
            }
            else {
                category = "-";
                storeName = "-";
            }

            getline(ss, comment, ',');

            transactions.emplace_back(userName, type, stod(summaStr), paymentMethod, category, storeName, comment);
            transactions.back().dateTime = dateTime;
        }
        file.close();
    }
    // –§—É–Ω–∫—Ü–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ —Ñ–∞–π–ª
    void saveTransactions() {
        ofstream file("transactions.txt", ios::trunc);
        if (file) {
            for (const auto& t : transactions) {
                file << t.toTXT() << endl;
            }
            file.close();
        }
        else {
            cout << "\n–û—à–∏–±–∫–∞ –∑–∞–ø–∏—Å–∏ –≤ —Ñ–∞–π–ª!\n";
        }
    }
    // —Ä–∞—Å—Ö–æ–¥ –∑–∞ –º–µ—Å—è—Ü
    double getMonthExpenses(const vector<Transaction>& transactions, int month, int year) {
        double total = 0;
        loadTransactions();
        for (const auto& t : transactions) {
            int transMonth = stoi(t.dateTime.substr(3, 2));
            int transYear = stoi(t.dateTime.substr(6, 4));

            if (transMonth == month && transYear == year && t.type == "—Ä–∞—Å—Ö–æ–¥") {
                total += t.summa;
            }
        }
        return total;
    }
    // —Å—Ä–µ–¥–Ω–∏–π —Ä–∞—Å—Ö–æ–¥ –≤ –¥–µ–Ω—å
    double getAverageDayExpense(const vector<Transaction>& transactions) {
        loadTransactions();
        double total = getMonthExpenses(transactions, getNowMonth(), getNowYear());
        int nowDay = getMaxDay(transactions);
        return (nowDay > 0) ? (total / nowDay) : 0.0;
    }
    // —Å—Ä–µ–¥–Ω–∏–π —Ä–∞—Å—Ö–æ–¥ –≤ –º–µ—Å—è—Ü
    double getAverageMonthExpense(const vector<Transaction>& transactions) {
        loadTransactions();
        if (transactions.empty()) return 0.0;
        double total = 0;
        int minMonth = 12, minYear = 3000, maxMonth = 1, maxYear = 1900;

        for (const auto& t : transactions) {
            if (t.type == "—Ä–∞—Å—Ö–æ–¥") {
                int transMonth = stoi(t.dateTime.substr(3, 2));
                int transYear = stoi(t.dateTime.substr(6, 4));

                total += t.summa;

                // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –∏ –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –º–µ—Å—è—Ü
                if (transYear < minYear || (transYear == minYear && transMonth < minMonth)) {
                    minYear = transYear;
                    minMonth = transMonth;
                }
                if (transYear > maxYear || (transYear == maxYear && transMonth > maxMonth)) {
                    maxYear = transYear;
                    maxMonth = transMonth;
                }
            }
        }
        int totalMonths = (maxYear - minYear) * 12 + (maxMonth - minMonth) + 1;
        return (totalMonths > 0) ? (total / totalMonths) : 0.0; 
    }
    // –ø–æ–ª—É—á–µ–Ω–∏–µ —Ñ–æ—Ä–º–∞–ª—å–Ω–æ–π –¥–∞—Ç—ã –∏–∑ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
    int getMaxDay(const vector<Transaction>& transactions) {
        int currentDay = getNowDay(); // –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â—É—é –¥–∞—Ç—É
        int maxDay = currentDay;

        // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –∏ –ø—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ—Å–ª–µ–¥–Ω—é—é –¥–∞—Ç—É
        for (const auto& t : transactions) {
            int transDay = stoi(t.dateTime.substr(0, 2));
            int transMonth = stoi(t.dateTime.substr(3, 2));
            int transYear = stoi(t.dateTime.substr(6, 4));

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å–ª–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –≤ —Ç–µ–∫—É—â–µ–º –º–µ—Å—è—Ü–µ –∏ –≥–æ–¥—É
            if (transMonth == getNowMonth() && transYear == getNowYear()) {
                maxDay = max(maxDay, transDay); // üìå –ë–µ—Ä–µ–º –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –¥–µ–Ω—å
            }
        }
        return maxDay;
    }
    // –ø–æ–ª—É—á–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ –¥–Ω—è, –º–µ—Å—è—Ü–∞, –≥–æ–¥–∞
    int getNowDay() {
        time_t now = time(0);
        tm localTime;
        localtime_s(&localTime, &now);
        return localTime.tm_mday;
    }
    int getNowMonth() {
        time_t now = time(0);
        tm localTime;
        localtime_s(&localTime, &now);
        return localTime.tm_mon + 1;
    }
    int getNowYear() {
        time_t now = time(0);
        tm localTime;
        localtime_s(&localTime, &now);
        return localTime.tm_year + 1900;
    }
    // –ø–æ–∏—Å–∫ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –ø–æ –¥–∞—Ç–µ
    vector<Transaction*> searchTransByDate(const string& targetDate) {
        vector<Transaction*> filteredTransactions;
        for (auto& t : transactions) {
            if (t.dateTime.substr(0, 10) == targetDate) {
                filteredTransactions.push_back(&t);
            }
        }
        return filteredTransactions;
    }
    // –ø–æ–∏—Å–∫ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
    vector<Transaction*> searchTransByCategory(const string& targetCategory) {
        vector<Transaction*> filteredTransactions;
        for (auto& t : transactions) {
            if (t.category == targetCategory) {
                filteredTransactions.push_back(&t);
            }
        }
        return filteredTransactions;
    }
    // –ø–æ–∏—Å–∫ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –ø–æ –º–∞–≥–∞–∑–∏–Ω—É
    vector<Transaction*> searchTransByStore(const string& targetStore) {
        vector<Transaction*> filteredTransactions;
        for (auto& t : transactions) {
            if (t.storeName == targetStore) {
                filteredTransactions.push_back(&t);
            }
        }
        return filteredTransactions;
    }
    // –ø–æ–∏—Å–∫ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –ø–æ —Å—É–º–º–µ (–¥–∏–∞–ø–∞–∑–æ–Ω)
    vector<Transaction*> searchTransByAmount(double minAmount, double maxAmount) {
        vector<Transaction*> filteredTransactions;
        for (auto& t : transactions) {
            if (t.summa >= minAmount && t.summa <= maxAmount) {
                filteredTransactions.push_back(&t);
            }
        }
        return filteredTransactions;
    }
    // –ø–æ–∏—Å–∫ –ø–æ –∫–ª—é—á–µ–≤–æ–º—É —Å–ª–æ–≤—É –≤ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è—Ö
    vector<Transaction*> searchTransByKeyword(const string& keyword) {
        vector<Transaction*> filteredTransactions;
        for (auto& t : transactions) {
            if (t.comment.find(keyword) != string::npos) { // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å–æ–¥–µ—Ä–∂–∏—Ç –ª–∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∫–ª—é—á–µ–≤–æ–µ —Å–ª–æ–≤–æ
                filteredTransactions.push_back(&t);
            }
        }
        return filteredTransactions;
    }

    // –¥–æ—Ö–æ–¥ –∑–∞ –º–µ—Å—è—Ü
    double getIncomeForMonth(const vector<Transaction>& transactions, int month, int year) {
        loadTransactions();
        double totalIncome = 0;
        for (const auto& t : transactions) {
            int transMonth = stoi(t.dateTime.substr(3, 2));
            int transYear = stoi(t.dateTime.substr(6, 4));

            if (transMonth == month && transYear == year && t.type == "–¥–æ—Ö–æ–¥") {
                totalIncome += t.summa;
            }
        }
        return totalIncome;
    }
    
    void showMenu() {
        cout << B << YELLOW << "Esc - –í—ã—Ö–æ–¥\n\n";
        cout << "======= –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é =======\n";
        cout << "1. –ë–∞–ª–∞–Ω—Å\n";                          // +
        cout << "2. –î–æ–±–∞–≤–∏—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é\n";             // +
        cout << "3. –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é\n";        // +
        cout << "4. –£–¥–∞–ª–∏—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é\n";              // +
        cout << "5. –ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏\n";         // +
        cout << "6. –ë—ã—Å—Ç—Ä—ã–π –ø–µ—Ä–µ–≤–æ–¥ –º–µ–∂–¥—É —Å—á–µ—Ç–∞–º–∏\n";   // +
        cout << "7. –ü–æ–∏—Å–∫\n";                           // +
        cout << "8. –§–∏–ª—å—Ç—Ä—ã\n";                         // +
        cout << "9. –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞\n";                      // +
        cout << "0. –ù–∞—Å—Ç—Ä–æ–π–∫–∏\n";                       // +
        cout << "–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ:" << RESET;
    }
};

// –ì–ª–∞–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è
static void Menu(MoneyManager& money_manager) {
    while (true) {
        clearConsole();
        money_manager.showMenu();

        char choice = _getch();
        if (choice == 27) break; // Esc –¥–ª—è –≤—ã—Ö–æ–¥–∞

        if (choice != '1' && choice != '2' && choice != '3' && choice != '4'
            && choice != '5' && choice != '6' && choice != '7' && choice != '8' 
            && choice != '9' && choice != '0') {
            continue;
        }

        clearConsole();
        switch (choice) {
        case '1': { money_manager.Balance(); break; }
        case '2': { money_manager.addTransaction(); break;    }
        case '3': { money_manager.redactTransaction(); break; }
        case '4': { money_manager.deleteTransaction(); break; }
        case '5': { money_manager.showTransactions(); break;  }
        case '6': { money_manager.transferBalance(); break; }
        case '7': { money_manager.search(); break; }
        case '8': { money_manager.filter(); break; }
        case '9': { money_manager.Statistics(); break; }
        case '0': { money_manager.setupSettings(); break; }
        }

        cout << B << "\n–ù–∞–∂–º–∏—Ç–µ Esc, —á—Ç–æ–±—ã –≤–µ—Ä–Ω—É—Ç—å—Å—è –≤ –º–µ–Ω—é...";
        while (_getch() != 27);
    }
}

int main() {
    SetConsoleCP(1251);
    SetConsoleOutputCP(1251);
    setlocale(LC_ALL, "RU");
    SetConsoleTitle(L"–£—á—ë—Ç –¥–æ–º–∞—à–Ω–∏—Ö —Ñ–∏–Ω–∞–Ω—Å–æ–≤");

    HWND consoleWindow = GetConsoleWindow();
    RECT screenRect;
    GetWindowRect(GetDesktopWindow(), &screenRect);
    int screenWidth = screenRect.right;
    int screenHeight = screenRect.bottom;
    int consoleWidth = 1500; // –®–∏—Ä–∏–Ω–∞
    int consoleHeight = 600; // –í—ã—Å–æ—Ç–∞
    int x = (screenWidth - consoleWidth) / 2;
    int y = (screenHeight - consoleHeight) / 2;
    MoveWindow(consoleWindow, x, y, consoleWidth, consoleHeight, TRUE);

    MoneyManager money_manager;
    showWelcomeScreen();
    Menu(money_manager);
    return 0;
}
